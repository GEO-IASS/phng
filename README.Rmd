---
output: github_document
---
# phng

[![Build Status Linux](https://travis-ci.org/mlr-org/phng.svg?branch=master)](https://travis-ci.org/mlr-org/phng)
[![Build Status Windows](https://ci.appveyor.com/api/projects/status/m26qhpq99cka8l1b?svg=true)](https://ci.appveyor.com/project/jakob-r/phng)
[![Coverage Status](https://coveralls.io/repos/github/mlr-org/phng/badge.svg?branch=master)](https://coveralls.io/github/mlr-org/phng?branch=master)


```{r, setup, include=FALSE}
set.seed(123)
knitr::opts_chunk$set(cache = TRUE, collapse = FALSE, warning = FALSE, error = FALSE)
library(phng)
```

Universal Parameter Space Description and Tools

* [Issues and Bugs](https://github.com/mlr-org/phng/issues)
* [Documentation](https://mlr-org.github.io/phng)

## Installation
```{r, eval=FALSE}
devtools::install_github("mlr-org/phng", dependencies = TRUE)
```

## Usage

Create a simple ParamSet using all supported Parameter Types:

* _Int_egers
* _Real_-valued numbers
* _Flag_ for `TRUE`/`FALSE`
* _Categorical_ values, namely characters.
* Further types are only possible by using transformations.

```{r}
ps = ParamSetFlat$new(
  params = list(
    ParamInt$new(id = "z", lower = 1, upper = 3),
    ParamReal$new(id = "x", lower = -10, upper = 10),
    ParamFlag$new(id = "switch"),
    ParamCategorical$new(id = "methods", values = c("a","b","c"))
  )
)
```

Draw random samples / create random design:
```{r ps}
ps$sample(3)
```

Generate LHS Design:
```{r pslhs}
ps$generateLHSDesign(3)
```

Generate Grid Design:
```{r psgrid}
ps$generateGridDesign(resolution = 2)
```

Properties of the parameters within the ParamSet:
```{r psprobs}
ps$values
ps$param.classes
ps$nlevels
```

### Numeric ParamSet

Things you can do on an all numeric ParamSet:
```{r psnumeric}
ps = ParamSetFlat$new(
  params = c(
    list(ParamInt$new(id = "z", lower = -10, upper = 10)),
    repeatParam(2, ParamReal$new(id = "x", lower = 0, upper = 10))
  )
)

ps$lower
ps$upper
ps$range
```

The usage of `repeatParam` generates tags show to which group the parameters belong to:

```{r psnumerictags}
ps$member.tags
```

This becomes useful if you want to do operations on parameters of one group like with transformations.

### Transformations

Transformations are functions with a fixed signature.

* `x` A named list of parameter values. Each list item contains a vector of parameter values of a single parameter.
* `dict` An environment that can be accessed using the `$` operator. It can contains values that don't belong to any parameter but are important for transformations.
* `tags` A list of the tags for each parameter. Each parameter can have a various tags indicating additional characteristics.


### ParamTree
```{r}
  pt = ParamTree$fac(
      ParamTree$dn(node = ParamCategorical$new(id = "model", values = c("SVM", "RF"))),
      ParamTree$dn(node = ParamReal$new(id = "C", lower = 0, upper = 100), depend = list(id = "model", val = "SVM")),
      ParamTree$dn(node = ParamCategorical$new(id = "kernel", values = c("rbf", "poly")), depend = list(id = "model", val = "SVM")),
      ParamTree$dn(node = ParamReal$new(id = "gamma", lower = 0, upper = 100), depend = list(id = "kernel", val = "rbf")),
      ParamTree$dn(node = ParamInt$new(id = "n", lower = 1L, upper = 10L), depend = list(id = "kernel", val = "poly"))
      )
  pt$sample()
  pt$toStringVal()
```

or one could build a tree mannually
```{r}
  ps = ParamHandle$new(node = ParamCategorical$new(id = "Model", values = c("SVM", "RF")))
  ps$setRoot(ps)
  temp = ParamHandle$new(node = ParamInt$new(id = "n_tree", lower = 1L, upper = 10L), depend = list(id = "Model", val = "RF"))
  ntree = ps$addCondChild(temp)
  temp = ParamHandle$new(node = ParamReal$new(id = "C", lower = 0, upper = 100), depend = list(id = "Model", val = "SVM"))
  c = ps$addCondChild(temp)
  temp = ParamHandle$new(node = ParamCategorical$new(id = "kernel", values = c("rbf", "poly")), depend = list(id = "Model", val = "SVM"))
  kernel = ps$addCondChild(temp)
  temp = ParamHandle$new(node = ParamReal$new(id = "gamma", lower = 0, upper = 100), depend = list(id = "kernel", val = "rbf"))
  gamma = kernel$addCondChild(temp)
  temp = ParamHandle$new(node = ParamInt$new(id = "n", lower = 1L, upper = 10L), depend = list(id = "kernel", val = "poly"))
  poly = kernel$addCondChild(temp)
  list.flat = ps$visitor$toFlat()
  ps$toStringVal()
  ps$sample()
  ps$toStringVal()  # after sampling, the string might be different
  list.flat = ps$visitor$toFlat()
  poly$getRoot$sample() # use the root to sample
  ps$toStringVal()
```
